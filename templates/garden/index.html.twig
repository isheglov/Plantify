<!DOCTYPE html>
<html>
<head>
    <title>Plantify</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        table {
            position: absolute;
            left: 100px;
            top: 150px;
        }
        /*button {*/
        /*    position: absolute;*/
        /*    left: 100px;*/
        /*    top: 120px;*/
        /*}*/
        table, th, td {
            /*border: 1px solid black;*/
            border-collapse: collapse;
        }
        th, td {
            padding: 15px;
        }
        label, input { display:block; }
        input.text { margin-bottom:12px; width:95%; padding: .4em; }
        select { margin-bottom:12px; width:95%; padding: .4em; }
        fieldset { padding:0; border:0; margin-top:25px; }
        h1 { font-size: 1.2em; margin: .6em 0; }
        div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
        div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
        .ui-dialog .ui-state-error { padding: .3em; }
    </style>
{#    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>#}

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body>

<div id="dialog-form" title="Что здесь растет">
    <form>
        <fieldset>
            <label for="plant">Название</label>
{#            <input type="text" name="plant" id="plant" value="Петрушка" class="text ui-widget-content ui-corner-all">#}
            <select name="plant" id="plant" class="select text ui-widget-content ui-corner-all">
                {% for plant in plantList %}
                <option value="{{ plant.id }}">{{ plant.name }}</option>
                {% endfor %}
            </select>

            <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
        </fieldset>
    </form>
</div>

<table style="width:400px">
    <th>Схема участка</th>
    {% for i in 0..dimensionY-1 %}
        <tr>
            {% for j in 0..dimensionX-1 %}
                <td id="cell{{ gardenCellList[j][i]['cellId'] }}">
                    {{ gardenCellList[j][i]['plantName'] }}
{#                    {{ gardenCellList[j][i]['plantId'] }}#}
                </td>
            {% endfor %}
        </tr>
    {% endfor %}
</table>


<div>
<button id="suggestion">Что дальше сажать</button>
</div>
<div>
<button id="combined">Комбинированные посадки</button>
</div>
<form action="/garden/delete" method="post">
    <button id="delete">Удалить</button>
</form>

<script>
    jQuery( function() {
        var clickedId;
        var dialog, form;

        function setPlant() {
            jQuery( "#"+clickedId )[0].innerText = $( "#plant option:selected" ).text();

            let cellId = clickedId.replace('cell','');
            let plantId = $( "#plant option:selected" ).val();

            $.ajax({
                url: '/garden/cell/'+cellId+'/plant/'+plantId,
                type: 'PUT',
                success: function(result) {
                    console.log(result);
                }
            });

            dialog.dialog( "close" );
        }

        dialog = jQuery( "#dialog-form" ).dialog({
            autoOpen: false,
            height: 400,
            width: 350,
            modal: true,
            buttons: {
                "Сохранить": setPlant,
                Cancel: function() {
                    dialog.dialog( "close" );
                }
            },
            close: function() {
                form[ 0 ].reset();
            }
        });

        form = dialog.find( "form" ).on( "submit", function( event ) {
            event.preventDefault();
            setPlant();
        });

        jQuery( "[id^=cell]" ).button().on( "click", function() {
            dialog.dialog( "open" );
            clickedId = this.id;
        });
    } );
</script>
</body>
</html>
